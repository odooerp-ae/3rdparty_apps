<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="payment_tabby_product_widget" inherit_id="website_sale.product_price">
            <xpath expr="//div//h3[hasclass('decimal_precision')]" position="after">
                <t t-set="tabby_acq"
                    t-value="request.env['payment.provider'].sudo().search([('code','=','tabby'),('state','in',['test','enabled'])],limit=1)" />
                <t t-if="tabby_acq">
                    <script src="https://checkout.tabby.ai/tabby-promo.js"></script>
                    <t t-set="current_website" t-value="request.env['website'].get_current_website()"/>
                    <t t-set="session_lang" t-value="request.session.context.get('lang','en')"/>

                    <script> new TabbyPromo({ selector: '#TabbyPromo', currency: '<t
                            t-esc="website.currency_id.name" />', price: '<t
                            t-esc="combination_info['price']" />', lang: '<t
                            t-esc="request.env.lang.split('_')[0]" />', source: 'product',
                        publicKey: '<t t-esc="tabby_acq.tabby_public_key" />', merchantCode: '<t
                            t-esc="tabby_acq.tabby_merchant_code" />' }); </script>
                    <div id="TabbyPromo"></div>
                </t>
            </xpath>
        </template>


        <template id="payment_tabby_method_form_widget" inherit_id="payment.method_form">
            <xpath expr="//div[@name='o_payment_inline_form']" position="before">
                <t t-if="provider_sudo.code == 'tabby'">
                    <script src="https://checkout.tabby.ai/tabby-card.js"></script>
                    <script> new TabbyCard({ selector: '#tabbyCard', currency: '<t
                            t-esc="request.website.sale_get_order().currency_id.name" />', lang: '<t
                            t-esc="request.env.lang.split('_')[0]" />', price: <t
                            t-esc="request.website.sale_get_order().amount_total" />, size: 'wide', header: true
                        }); </script>
                    <div class="card">
                        <div class="card-body" id="tabbyCard"></div>
                    </div>
                </t>
            </xpath>
        </template>

    </data>
</odoo>